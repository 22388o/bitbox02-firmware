#!/bin/bash

set -e

# Check style

./.ci/check-style
make -C py
./.ci/check-pep8
# implicit-reexport: `from foo import bar` re-exports (normal Python3 behavior), otherwise mypy expects
# `from foo import bar as bar`.
# namespace-packages: follow imports in subfolders without `__init__.py` (also normal Python3 behavior).
(cd py && mypy --implicit-reexport --namespace-packages --ignore-missing-imports --strict .)

# Bootloader variants
make -j8 bootloader
make -j8 bootloader-devdevice
make -j8 bootloader-production

# Firmware
make -j8 firmware
./scripts/tidy # run tidy on the firmware build

make -j8 factory-setup

# Unit tests
make -j8 run-unit-tests

# Build device tests
make -j8 device-test
